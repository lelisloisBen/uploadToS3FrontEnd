<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload File To S3</title>
</head>
<body>

    

        <label for="user_file">Upload Your File</label>
        <br></br>
        <input id="fileinput" type="file" name="user_file" accept="image/*">
        <br></br>
        <button type="submit" onclick="onSelectFile()" >Upload</button>

        <hr><hr>

        <label for="upp_files">Upload all Files you want</label>
        <br></br>
        <input id="myFiles" type="file" name="files[]" multiple accept="image/*" >
        <br></br>
        <button type="submit" onclick="submitFiles()" >Upload</button>
        
        <hr><hr>

        <label for="reFile">Upload one File and resize it</label>
        <br></br>
        <input id="fileResize" type="file" name="reFile" accept="image/*">
        <br></br>
        <button type="submit" onclick="submitResize()" >Upload</button>


<script>

loadProgressBar()

//---------- Upload one file at the time and Resize ---------------------------------------------
    
    const inputR = document.getElementById('fileResize');

    const submitResize = () => {
        resizeOne(inputR.files[0])
    };

    const resizeOne = (file) => {

        let fdR = new FormData();
        fdR.append('fileToResize', file);
        console.log(Array.from(fdR));

        axios.request( {
        method: "post", 
        url: "https://samir-upload.herokuapp.com/resize", 
        data: fdR, 
            onUploadProgress: (p) => {
                console.log(p); 
                this.setState({
                fileprogress: p.loaded / p.total
                })
            }
        }).then (data => {
            this.setState({
                fileprogress: 1.0,
            })
        })

        // fetch('https://samir-upload.herokuapp.com/resize', {
        //     method: 'PUT',
        //     body: fdR
        // })
        // .then(
        //     response => response.json()
        // ).then(
        //     success => console.log(success)
        // ).catch(
        //     error => console.log(error)
        // );
    };

    


//------------ Upload many files ---------------------------------------------------

    const myInputFiles = document.getElementById('myFiles');

    const submitFiles = () => {
        uploadALL(myInputFiles.files)
    };

    const uploadALL = (files) => {

        console.log("the files: ",files)

        let formData = new FormData();

        for (let i = 0; i < files.length; i++) {
            formData.append('files[]', files[i])
        }

        fetch('https://samir-upload.herokuapp.com/multi', {
            method: 'PUT',
            body: formData
        })
        .then(
            response => response.json()
        ).then(
            success => console.log(success)
        ).catch(
            error => console.log(error)
        );
    };

//-------------- Upload one file at the time ---------------------------------------------

    const input = document.getElementById('fileinput');

    const upload = (file) => {

        let fd = new FormData();
        fd.append('the_file', file);

        fetch('https://samir-upload.herokuapp.com/upload', {
            method: 'PUT',
            body: fd
        })
        .then(
            response => response.json()
        ).then(
            success => console.log(success)
        ).catch(
            error => console.log(error)
        );
    };

    // Event handler executed when a file is selected
    const onSelectFile = () => {
        upload(input.files[0])
    };

    // Add a listener on your input
    // It will be triggered when a file will be selected
    // input.addEventListener('change', onSelectFile, false);
</script>

<script src="https://cdn.rawgit.com/rikmms/progress-bar-4-axios/0a3acf92/dist/index.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>  
 
</body>
</html>